<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>واجهة البيع</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      background-color: #111;
      color: white;
      font-family: sans-serif;
      padding: 20px;
      direction: rtl;
      position: relative;
      min-height: 100vh;
    }
    h1 {
      text-align: center;
      font-size: 28px;
      margin-bottom: 20px;
    }
    .triangle-container {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .box {
      background-color: #222;
      padding: 30px;
      border-radius: 20px;
      width: 200px;
      text-align: center;
      box-shadow: 0 0 8px #00f, inset 0 0 10px #00f;
      font-size: 20px;
    }
    input, select {
      width: 100%;
      padding: 10px;
      border-radius: 10px;
      border: none;
      background-color: #333;
      color: white;
      font-size: 18px;
      text-align: center;
      margin-top: 10px;
    }
    button {
      background-color: blue;
      border: none;
      color: white;
      font-size: 20px;
      padding: 12px 30px;
      border-radius: 20px;
      cursor: pointer;
      width: 100%;
      margin-top: 15px;
      box-shadow: 0 0 15px blue;
    }
    button:hover {
      background-color: #0044cc;
    }
    #salesTable {
      margin-top: 30px;
      width: 100%;
      border-collapse: collapse;
    }
    #salesTable th, #salesTable td {
      border: 1px solid #444;
      padding: 10px;
      text-align: center;
    }
    #salesTable th {
      background-color: #222;
    }
    #salesTable td {
      background-color: #333;
    }
    .summary {
      margin-top: 20px;
      font-size: 20px;
      text-align: center;
    }
    #menu-btn {
      font-size: 28px;
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      padding: 5px 10px;
    }
    #menu {
      display: none;
      background: #222;
      border: 1px solid #444;
      padding: 10px;
      position: absolute;
      top: 40px;
      left: 10px;
      z-index: 9999;
      border-radius: 10px;
      min-width: 150px;
    }
    #menu a {
      display: block;
      color: white;
      text-decoration: none;
      margin-bottom: 5px;
      text-align: right;
      font-size: 16px;
      padding: 5px 10px;
      border-radius: 6px;
    }
    #menu a:hover {
      background-color: #444;
    }
  </style>
</head>
<body>

<button id="menu-btn" onclick="toggleMenu()">⋮</button>
<div id="menu">
  <a href="index.html">🏠 الواجهة الرئيسية</a>
  <a href="sales.html">📊 سجل المبيعات</a>
  <a href="stock.html">📦 إدارة المخزون</a>
</div>

<h1>واجهة البيع</h1>

<div class="triangle-container">
  <div class="box">
    المنتج
    <select id="productSelect">
      <option value="">اختر منتج</option>
    </select>
  </div>
  <div class="box">
    الكمية
    <input type="number" id="quantityInput" min="1" placeholder="مثلاً: 2">
  </div>
  <div class="box">
    سعر البيع
    <input type="number" id="priceInput" min="1" placeholder="مثلاً: 20000">
  </div>
</div>

<button onclick="sellProduct()">احفظ البيع</button>

<table id="salesTable">
  <thead>
    <tr>
      <th>المنتج</th>
      <th>الكمية</th>
      <th>سعر البيع</th>
      <th>الإجمالي</th>
      <th>الربح</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div class="summary">
  إجمالي المبيعات: <span id="totalSales">0</span> ل.س | إجمالي الربح: <span id="totalProfit">0</span> ل.س
</div>

<script>
function toggleMenu() {
  const menu = document.getElementById("menu");
  menu.style.display = menu.style.display === "block" ? "none" : "block";
}

// جلب المنتجات من المخزون
let products = JSON.parse(localStorage.getItem("products")) || {};
let sales = JSON.parse(localStorage.getItem("sales")) || [];

function populateProducts() {
  const select = document.getElementById("productSelect");
  select.innerHTML = '<option value="">اختر منتج</option>';
  for (const name in products) {
    select.innerHTML += `<option value="${name}">${name} (${products[name].stock} متبقي)</option>`;
  }
}
populateProducts();

function updateSalesTable() {
  const tbody = document.querySelector("#salesTable tbody");
  tbody.innerHTML = "";
  let totalSales = 0;
  let totalProfit = 0;

  sales.forEach(sale => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${sale.name}</td>
      <td>${sale.quantity}</td>
      <td>${sale.price}</td>
      <td>${sale.total}</td>
      <td>${sale.profit}</td>
    `;
    tbody.appendChild(row);
    totalSales += sale.total;
    totalProfit += sale.profit;
  });

  document.getElementById("totalSales").textContent = totalSales.toFixed(0);
  document.getElementById("totalProfit").textContent = totalProfit.toFixed(0);
}

function sellProduct() {
  const name = document.getElementById("productSelect").value;
  const quantity = parseInt(document.getElementById("quantityInput").value);
  const price = parseFloat(document.getElementById("priceInput").value);

  if (!name || !quantity || quantity <= 0 || !price || price <= 0) {
    alert("يرجى ملء جميع الحقول بشكل صحيح");
    return;
  }

  if (!products[name] || products[name].stock < quantity) {
    alert("الكمية المطلوبة أكبر من المخزون المتوفر");
    return;
  }

  const total = quantity * price;
  const profit = quantity * (price - products[name].cost);

  // خصم الكمية من المخزون
  products[name].stock -= quantity;
  localStorage.setItem("products", JSON.stringify(products));
  populateProducts();

  // تسجيل البيع
  const sale = { name, quantity, price, total, profit };
  sales.push(sale);
  localStorage.setItem("sales", JSON.stringify(sales));

  updateSalesTable();

  document.getElementById("quantityInput").value = "";
  document.getElementById("priceInput").value = "";
}

updateSalesTable();
</script>

</body>
</html>
