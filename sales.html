<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      background-color: #111;
      color: white;
      font-family: sans-serif;
      padding: 20px;
      direction: rtl;
      min-height: 100vh;
    }
    h1 {
      text-align: center;
      font-size: 28px;
      margin-bottom: 20px;
    }
    #menu-btn {
      font-size: 28px;
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      padding: 5px 10px;
      position: absolute;
      top: 10px;
      left: 10px;
    }
    #menu {
      display: none;
      background: #222;
      border: 1px solid #444;
      padding: 10px;
      position: absolute;
      top: 50px;
      left: 10px;
      z-index: 9999;
      border-radius: 10px;
      min-width: 150px;
    }
    #menu a {
      display: block;
      color: white;
      text-decoration: none;
      margin-bottom: 5px;
      text-align: right;
      font-size: 16px;
      padding: 5px 10px;
      border-radius: 6px;
    }
    #menu a:hover {
      background-color: #444;
    }
    .sales-container {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .month-box {
      background-color: #222;
      border-radius: 15px;
      padding: 15px;
      box-shadow: 0 0 10px #00f;
    }
    .month-header {
      font-size: 20px;
      margin-bottom: 10px;
    }
    .day-box {
      background-color: #333;
      border-radius: 10px;
      padding: 10px;
      margin-bottom: 8px;
      box-shadow: 0 0 8px #00f;
    }
    .day-header {
      font-size: 18px;
      margin-bottom: 5px;
    }
    .sale-item {
      display: flex;
      justify-content: space-between;
      padding: 3px 5px;
      border-bottom: 1px solid #444;
    }
    .delete-btn {
      background-color: red;
      border: none;
      border-radius: 6px;
      color: white;
      cursor: pointer;
      padding: 2px 6px;
      font-size: 12px;
    }
  </style>
</head>
<body>

<button id="menu-btn" onclick="toggleMenu()">â‹®</button>
<div id="menu">
  <a href="index.html">ğŸ  Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³Ø©</a>
  <a href="stocks.html">ğŸ“¦ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</a>
</div>

<h1>Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h1>
<div class="sales-container" id="salesContainer"></div>

<script>
function toggleMenu() {
  const menu = document.getElementById("menu");
  menu.style.display = menu.style.display === "block" ? "none" : "block";
}

// Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
let sales = JSON.parse(localStorage.getItem("sales")) || [];
let stocks = JSON.parse(localStorage.getItem("stocks")) || {};

function saveSales() {
  localStorage.setItem("sales", JSON.stringify(sales));
}

function saveStocks() {
  localStorage.setItem("stocks", JSON.stringify(stocks));
}

function deleteSale(monthKey, dayKey, index) {
  const sale = sales[monthKey][dayKey][index];
  // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ÙƒÙ…ÙŠØ© Ù„Ù„Ù…Ø®Ø²ÙˆÙ†
  if(stocks[sale.name]) {
    stocks[sale.name].stock += sale.quantity;
  } else {
    stocks[sale.name] = { stock: sale.quantity, cost: sale.cost || 0 };
  }
  alert(`ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© ${sale.quantity} ${sale.name} Ù„Ù„Ù…Ø®Ø²ÙˆÙ†`);
  // Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ¹
  sales[monthKey][dayKey].splice(index, 1);
  if(sales[monthKey][dayKey].length === 0) delete sales[monthKey][dayKey];
  if(Object.keys(sales[monthKey]).length === 0) delete sales[monthKey];
  saveSales();
  saveStocks();
  renderSales();
}

function renderSales() {
  const container = document.getElementById("salesContainer");
  container.innerHTML = "";

  const months = Object.keys(sales).sort((a,b)=>b.localeCompare(a));
  months.forEach(monthKey => {
    const monthBox = document.createElement("div");
    monthBox.className = "month-box";

    // Ø§Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø´Ù‡Ø±
    let monthTotal = 0;
    let monthProfit = 0;
    for(const dayKey in sales[monthKey]){
      sales[monthKey][dayKey].forEach(sale=>{
        monthTotal += sale.total;
        monthProfit += sale.profit;
      });
    }

    monthBox.innerHTML = `<div class="month-header">Ø´Ù‡Ø± ${monthKey} - Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª: ${monthTotal.toFixed(0)} Ù„.Ø³ | Ø§Ù„Ø£Ø±Ø¨Ø§Ø­: ${monthProfit.toFixed(0)} Ù„.Ø³</div>`;

    const days = Object.keys(sales[monthKey]).sort((a,b)=>b.localeCompare(a));
    days.forEach(dayKey=>{
      const dayBox = document.createElement("div");
      dayBox.className = "day-box";

      let dayTotal = 0;
      let dayProfit = 0;
      sales[monthKey][dayKey].forEach(sale=>{
        dayTotal += sale.total;
        dayProfit += sale.profit;
      });

      dayBox.innerHTML = `<div class="day-header">Ø§Ù„ÙŠÙˆÙ… ${dayKey} - Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª: ${dayTotal.toFixed(0)} Ù„.Ø³ | Ø§Ù„Ø£Ø±Ø¨Ø§Ø­: ${dayProfit.toFixed(0)} Ù„.Ø³</div>`;

      // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
      sales[monthKey][dayKey].slice().reverse().forEach((sale,index)=>{
        const item = document.createElement("div");
        item.className = "sale-item";
        item.innerHTML = `${sale.name} - ${sale.quantity} Ã— ${sale.price} = ${sale.total} | Ø±Ø¨Ø­: ${sale.profit} 
        <button class="delete-btn" onclick="deleteSale('${monthKey}','${dayKey}',${index})">Ø­Ø°Ù</button>`;
        dayBox.appendChild(item);
      });

      monthBox.appendChild(dayBox);
    });

    container.appendChild(monthBox);
  });
}

// Ø¥Ø¹Ø§Ø¯Ø© ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø´Ù‡Ø± ÙˆØ§Ù„ÙŠÙˆÙ…
function organizeSales(rawSales) {
  const organized = {};
  rawSales.forEach(sale=>{
    const date = new Date(sale.time);
    const monthKey = `${date.getFullYear()}-${(date.getMonth()+1).toString().padStart(2,'0')}`;
    const dayKey = `${date.getDate().toString().padStart(2,'0')}`;
    if(!organized[monthKey]) organized[monthKey] = {};
    if(!organized[monthKey][dayKey]) organized[monthKey][dayKey] = [];
    organized[monthKey][dayKey].push(sale);
  });
  return organized;
}

// ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø®Ø§Ù…
sales = organizeSales(sales);

renderSales();
</script>

</body>
</html>
